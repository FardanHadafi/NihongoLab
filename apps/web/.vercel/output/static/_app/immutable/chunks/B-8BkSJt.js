var _e=Object.defineProperty;var Se=(e,t,n)=>t in e?_e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var j=(e,t,n)=>Se(e,typeof t!="symbol"?t+"":t,n);var Ee={},ce={};const X=Object.create(null),H=e=>{var t;return Ee||((t=globalThis.Deno)==null?void 0:t.env.toObject())||globalThis.__env__||(e?X:globalThis)},L=new Proxy(X,{get(e,t){return H()[t]??X[t]},has(e,t){return t in H()||t in X},set(e,t,n){const r=H(!0);return r[t]=n,!0},deleteProperty(e,t){if(!t)return!1;const n=H(!0);return delete n[t],!0},ownKeys(){const e=H(!0);return Object.keys(e)}});function v(e,t){return typeof process<"u"&&ce?ce[e]??t:typeof Deno<"u"?Deno.env.get(e)??t:typeof Bun<"u"?Bun.env[e]??t:t}const W=1,b=4,x=8,S=24,le={eterm:b,cons25:b,console:b,cygwin:b,dtterm:b,gnome:b,hurd:b,jfbterm:b,konsole:b,kterm:b,mlterm:b,mosh:S,putty:b,st:b,"rxvt-unicode-24bit":S,terminator:S,"xterm-kitty":S},Te=new Map(Object.entries({APPVEYOR:x,BUILDKITE:x,CIRCLECI:S,DRONE:x,GITEA_ACTIONS:S,GITHUB_ACTIONS:S,GITLAB_CI:x,TRAVIS:x})),Le=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function Pe(){if(v("FORCE_COLOR")!==void 0)switch(v("FORCE_COLOR")){case"":case"1":case"true":return b;case"2":return x;case"3":return S;default:return W}if(v("NODE_DISABLE_COLORS")!==void 0&&v("NODE_DISABLE_COLORS")!==""||v("NO_COLOR")!==void 0&&v("NO_COLOR")!==""||v("TERM")==="dumb")return W;if(v("TMUX"))return S;if("TF_BUILD"in L&&"AGENT_NAME"in L)return b;if("CI"in L){for(const{0:e,1:t}of Te)if(e in L)return t;return v("CI_NAME")==="codeship"?x:W}if("TEAMCITY_VERSION"in L)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(v("TEAMCITY_VERSION"))!==null?b:W;switch(v("TERM_PROGRAM")){case"iTerm.app":return!v("TERM_PROGRAM_VERSION")||/^[0-2]\./.exec(v("TERM_PROGRAM_VERSION"))!==null?x:S;case"HyperTerm":case"MacTerm":return S;case"Apple_Terminal":return x}if(v("COLORTERM")==="truecolor"||v("COLORTERM")==="24bit")return S;if(v("TERM")){if(/truecolor/.exec(v("TERM"))!==null)return S;if(/^xterm-256/.exec(v("TERM"))!==null)return x;const e=v("TERM").toLowerCase();if(le[e])return le[e];if(Le.some(t=>t.exec(e)!==null))return b}return v("COLORTERM")?b:W}const N={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",fg:{red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m"}},oe=["debug","info","success","warn","error"];function Ie(e,t){return oe.indexOf(t)>=oe.indexOf(e)}const Ae={info:N.fg.blue,success:N.fg.green,warn:N.fg.yellow,error:N.fg.red,debug:N.fg.magenta},Ue=(e,t,n)=>{const r=new Date().toISOString();return n?`${N.dim}${r}${N.reset} ${Ae[e]}${e.toUpperCase()}${N.reset} ${N.bright}[Better Auth]:${N.reset} ${t}`:`${r} ${e.toUpperCase()} [Better Auth]: ${t}`},Ce=e=>{const t="error",n=Pe()!==1,r=(s,c,u=[])=>{if(!Ie(t,s))return;const l=Ue(s,c,n);{s==="error"?console.error(l,...u):s==="warn"?console.warn(l,...u):console.log(l,...u);return}};return{...Object.fromEntries(oe.map(s=>[s,(...[c,...u])=>r(s,c,u)])),get level(){return t}}};Ce();function xe(e){return e.charAt(0).toUpperCase()+e.slice(1)}var Q=class extends Error{constructor(e,t){super(e),this.name="BetterAuthError",this.message=e,this.cause=t,this.stack=""}};function Ne(e){try{return(new URL(e).pathname.replace(/\/+$/,"")||"/")!=="/"}catch{throw new Q(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function Me(e){try{const t=new URL(e);if(t.protocol!=="http:"&&t.protocol!=="https:")throw new Q(`Invalid base URL: ${e}. URL must include 'http://' or 'https://'`)}catch(t){throw t instanceof Q?t:new Q(`Invalid base URL: ${e}. Please provide a valid base URL.`,String(t))}}function ee(e,t="/api/auth"){if(Me(e),Ne(e))return e;const n=e.replace(/\/+$/,"");return!t||t==="/"?n:(t=t.startsWith("/")?t:`/${t}`,`${n}${t}`)}function Be(e,t,n,r,s){if(e)return ee(e,t);{const c=L.BETTER_AUTH_URL||L.NEXT_PUBLIC_BETTER_AUTH_URL||L.PUBLIC_BETTER_AUTH_URL||L.NUXT_PUBLIC_BETTER_AUTH_URL||L.NUXT_PUBLIC_AUTH_URL||(L.BASE_URL!=="/"?L.BASE_URL:void 0);if(c)return ee(c,t)}if(typeof window<"u"&&window.location)return ee(window.location.origin,t)}const Fe={id:"redirect",name:"Redirect",hooks:{onSuccess(e){var t,n;if((t=e.data)!=null&&t.url&&((n=e.data)!=null&&n.redirect)&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},qe={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},De=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,fe={true:!0,false:!1,null:null,undefined:void 0,nan:NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},$e=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function je(e){return e instanceof Date&&!isNaN(e.getTime())}function ke(e){const t=$e.exec(e);if(!t)return null;const[,n,r,s,c,u,l,i,o,a,f]=t;let g=new Date(Date.UTC(parseInt(n,10),parseInt(r,10)-1,parseInt(s,10),parseInt(c,10),parseInt(u,10),parseInt(l,10),i?parseInt(i.padEnd(3,"0"),10):0));if(o){const w=(parseInt(a,10)*60+parseInt(f,10))*(o==="+"?-1:1);g.setUTCMinutes(g.getUTCMinutes()+w)}return je(g)?g:null}function Ve(e,t={}){const{strict:n=!1,warnings:r=!1,reviver:s,parseDates:c=!0}=t;if(typeof e!="string")return e;const u=e.trim();if(u.length>0&&u[0]==='"'&&u.endsWith('"')&&!u.slice(1,-1).includes('"'))return u.slice(1,-1);const l=u.toLowerCase();if(l.length<=9&&l in fe)return fe[l];if(!De.test(u)){if(n)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(qe).some(([i,o])=>{const a=o.test(u);return a&&r&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${i} pattern`),a})&&n)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(u,(o,a)=>{if(o==="__proto__"||o==="constructor"&&a&&typeof a=="object"&&"prototype"in a){r&&console.warn(`[better-json] Dropping "${o}" key to prevent prototype pollution`);return}if(c&&typeof a=="string"){const f=ke(a);if(f)return f}return s?s(o,a):a})}catch(i){if(n)throw i;return e}}function He(e,t={strict:!0}){return Ve(e,t)}let A=[],q=0;const G=4,ve=e=>{let t=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(r){return n.lc=t.push(r),()=>{for(let c=q+G;c<A.length;)A[c]===r?A.splice(c,G):c+=G;let s=t.indexOf(r);~s&&(t.splice(s,1),--n.lc||n.off())}},notify(r,s){let c=!A.length;for(let u of t)A.push(u,n.value,r,s);if(c){for(q=0;q<A.length;q+=G)A[q](A[q+1],A[q+2],A[q+3]);A.length=0}},off(){},set(r){let s=n.value;s!==r&&(n.value=r,n.notify(s))},subscribe(r){let s=n.listen(r);return r(n.value),s},value:e};return n},We=5,J=6,Y=10;let Ge=(e,t,n,r)=>(e.events=e.events||{},e.events[n+Y]||(e.events[n+Y]=r(s=>{e.events[n].reduceRight((c,u)=>(u(c),c),{shared:{},...s})})),e.events[n]=e.events[n]||[],e.events[n].push(t),()=>{let s=e.events[n],c=s.indexOf(t);s.splice(c,1),s.length||(delete e.events[n],e.events[n+Y](),delete e.events[n+Y])}),Je=1e3,be=(e,t)=>Ge(e,r=>{let s=t(r);s&&e.events[J].push(s)},We,r=>{let s=e.listen;e.listen=(...u)=>(!e.lc&&!e.active&&(e.active=!0,r()),s(...u));let c=e.off;return e.events[J]=[],e.off=()=>{c(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let u of e.events[J])u();e.events[J]=[]}},Je)},()=>{e.listen=s,e.off=c}});const Ye=()=>typeof window>"u",Xe=(e,t,n,r)=>{const s=ve({data:null,error:null,isPending:!0,isRefetching:!1,refetch:l=>c(l)}),c=async l=>new Promise(i=>{const o=typeof r=="function"?r({data:s.get().data,error:s.get().error,isPending:s.get().isPending}):r;n(t,{...o,query:{...o==null?void 0:o.query,...l==null?void 0:l.query},async onSuccess(a){var f;s.set({data:a.data,error:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await((f=o==null?void 0:o.onSuccess)==null?void 0:f.call(o,a))},async onError(a){var R,P;const{request:f}=a,g=typeof f.retry=="number"?f.retry:(R=f.retry)==null?void 0:R.attempts,w=f.retryAttempt||0;g&&w<g||(s.set({error:a.error,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await((P=o==null?void 0:o.onError)==null?void 0:P.call(o,a)))},async onRequest(a){var g;const f=s.get();s.set({isPending:f.data===null,data:f.data,error:null,isRefetching:!0,refetch:s.value.refetch}),await((g=o==null?void 0:o.onRequest)==null?void 0:g.call(o,a))}}).catch(a=>{s.set({error:a,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch})}).finally(()=>{i(void 0)})});e=Array.isArray(e)?e:[e];let u=!1;for(const l of e)l.subscribe(async()=>{Ye()||(u?await c():be(s,()=>{const i=setTimeout(async()=>{u||(await c(),u=!0)},0);return()=>{s.off(),l.off(),clearTimeout(i)}}))});return s},te=Symbol.for("better-auth:broadcast-channel"),Qe=()=>Math.floor(Date.now()/1e3);var ze=class{constructor(e="better-auth.message"){j(this,"listeners",new Set);j(this,"name");this.name=e}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}post(e){if(!(typeof window>"u"))try{localStorage.setItem(this.name,JSON.stringify({...e,timestamp:Qe()}))}catch{}}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=t=>{if(t.key!==this.name)return;const n=JSON.parse(t.newValue??"{}");(n==null?void 0:n.event)!=="session"||!(n!=null&&n.data)||this.listeners.forEach(r=>r(n))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}};function ne(e="better-auth.message"){return globalThis[te]||(globalThis[te]=new ze(e)),globalThis[te]}const re=Symbol.for("better-auth:focus-manager");var Ze=class{constructor(){j(this,"listeners",new Set)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setFocused(e){this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof document>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>{document.visibilityState==="visible"&&this.setFocused(!0)};return document.addEventListener("visibilitychange",e,!1),()=>{document.removeEventListener("visibilitychange",e,!1)}}};function de(){return globalThis[re]||(globalThis[re]=new Ze),globalThis[re]}const se=Symbol.for("better-auth:online-manager");var Ke=class{constructor(){j(this,"listeners",new Set);j(this,"isOnline",typeof navigator<"u"?navigator.onLine:!0)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setOnline(e){this.isOnline=e,this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>this.setOnline(!0),t=()=>this.setOnline(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e,!1),window.removeEventListener("offline",t,!1)}}};function ie(){return globalThis[se]||(globalThis[se]=new Ke),globalThis[se]}const k=()=>Math.floor(Date.now()/1e3),et=5;function tt(e){var I,E,y;const{sessionAtom:t,sessionSignal:n,$fetch:r,options:s={}}=e,c=((I=s.sessionOptions)==null?void 0:I.refetchInterval)??0,u=((E=s.sessionOptions)==null?void 0:E.refetchOnWindowFocus)??!0,l=((y=s.sessionOptions)==null?void 0:y.refetchWhenOffline)??!1,i={lastSync:0,lastSessionRequest:0,cachedSession:void 0},o=()=>l||ie().isOnline,a=m=>{if(!o())return;if((m==null?void 0:m.event)==="storage"){i.lastSync=k(),n.set(!n.get());return}const d=t.get();if((m==null?void 0:m.event)==="poll"){i.lastSessionRequest=k(),r("/get-session").then(_=>{_.error?t.set({...d,data:null,error:_.error}):t.set({...d,data:_.data,error:null}),i.lastSync=k(),n.set(!n.get())}).catch(()=>{});return}if((m==null?void 0:m.event)==="visibilitychange"){if(k()-i.lastSessionRequest<et)return;i.lastSessionRequest=k()}((d==null?void 0:d.data)===null||(d==null?void 0:d.data)===void 0||(m==null?void 0:m.event)==="visibilitychange")&&(i.lastSync=k(),n.set(!n.get()))},f=m=>{ne().post({event:"session",data:{trigger:m},clientId:Math.random().toString(36).substring(7)})},g=()=>{c&&c>0&&(i.pollInterval=setInterval(()=>{var m;(m=t.get())!=null&&m.data&&a({event:"poll"})},c*1e3))},w=()=>{i.unsubscribeBroadcast=ne().subscribe(()=>{a({event:"storage"})})},R=()=>{u&&(i.unsubscribeFocus=de().subscribe(()=>{a({event:"visibilitychange"})}))},P=()=>{i.unsubscribeOnline=ie().subscribe(m=>{m&&a({event:"visibilitychange"})})};return{init:()=>{g(),w(),R(),P(),ne().setup(),de().setup(),ie().setup()},cleanup:()=>{i.pollInterval&&(clearInterval(i.pollInterval),i.pollInterval=void 0),i.unsubscribeBroadcast&&(i.unsubscribeBroadcast(),i.unsubscribeBroadcast=void 0),i.unsubscribeFocus&&(i.unsubscribeFocus(),i.unsubscribeFocus=void 0),i.unsubscribeOnline&&(i.unsubscribeOnline(),i.unsubscribeOnline=void 0),i.lastSync=0,i.lastSessionRequest=0,i.cachedSession=void 0},triggerRefetch:a,broadcastSessionUpdate:f}}function nt(e,t){const n=ve(!1),r=Xe(n,"/get-session",e,{method:"GET"});return be(r,()=>{const s=tt({sessionAtom:r,sessionSignal:n,$fetch:e,options:t});return s.init(),()=>{s.cleanup()}}),{session:r,$sessionSignal:n}}var rt=Object.defineProperty,st=Object.defineProperties,it=Object.getOwnPropertyDescriptors,he=Object.getOwnPropertySymbols,ot=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable,ge=(e,t,n)=>t in e?rt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,U=(e,t)=>{for(var n in t||(t={}))ot.call(t,n)&&ge(e,n,t[n]);if(he)for(var n of he(t))at.call(t,n)&&ge(e,n,t[n]);return e},C=(e,t)=>st(e,it(t)),ut=class extends Error{constructor(e,t,n){super(t||e.toString(),{cause:n}),this.status=e,this.statusText=t,this.error=n,Error.captureStackTrace(this,this.constructor)}},ct=async(e,t)=>{var n,r,s,c,u,l;let i=t||{};const o={onRequest:[t==null?void 0:t.onRequest],onResponse:[t==null?void 0:t.onResponse],onSuccess:[t==null?void 0:t.onSuccess],onError:[t==null?void 0:t.onError],onRetry:[t==null?void 0:t.onRetry]};if(!t||!(t!=null&&t.plugins))return{url:e,options:i,hooks:o};for(const a of(t==null?void 0:t.plugins)||[]){if(a.init){const f=await((n=a.init)==null?void 0:n.call(a,e.toString(),t));i=f.options||i,e=f.url}o.onRequest.push((r=a.hooks)==null?void 0:r.onRequest),o.onResponse.push((s=a.hooks)==null?void 0:s.onResponse),o.onSuccess.push((c=a.hooks)==null?void 0:c.onSuccess),o.onError.push((u=a.hooks)==null?void 0:u.onError),o.onRetry.push((l=a.hooks)==null?void 0:l.onRetry)}return{url:e,options:i,hooks:o}},ye=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},lt=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function ft(e){if(typeof e=="number")return new ye({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new ye(e);case"exponential":return new lt(e);default:throw new Error("Invalid retry strategy")}}var dt=async e=>{const t={},n=async r=>typeof r=="function"?await r():r;if(e!=null&&e.auth){if(e.auth.type==="Bearer"){const r=await n(e.auth.token);if(!r)return t;t.authorization=`Bearer ${r}`}else if(e.auth.type==="Basic"){const[r,s]=await Promise.all([n(e.auth.username),n(e.auth.password)]);if(!r||!s)return t;t.authorization=`Basic ${btoa(`${r}:${s}`)}`}else if(e.auth.type==="Custom"){const[r,s]=await Promise.all([n(e.auth.prefix),n(e.auth.value)]);if(!s)return t;t.authorization=`${r??""} ${s}`}}return t},ht=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function gt(e){const t=e.headers.get("content-type"),n=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const r=t.split(";").shift()||"";return ht.test(r)?"json":n.has(r)||r.startsWith("text/")?"text":"blob"}function yt(e){try{return JSON.parse(e),!0}catch{return!1}}function ae(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function me(e){try{return JSON.parse(e)}catch{return e}}function pe(e){return typeof e=="function"}function mt(e){if(e!=null&&e.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&pe(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&pe(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function pt(e){const t=new Headers(e==null?void 0:e.headers),n=await dt(e);for(const[r,s]of Object.entries(n||{}))t.set(r,s);if(!t.has("content-type")){const r=vt(e==null?void 0:e.body);r&&t.set("content-type",r)}return t}function vt(e){return ae(e)?"application/json":null}function bt(e){if(!(e!=null&&e.body))return null;const t=new Headers(e==null?void 0:e.headers);if(ae(e.body)&&!t.has("content-type")){for(const[n,r]of Object.entries(e==null?void 0:e.body))r instanceof Date&&(e.body[n]=r.toISOString());return JSON.stringify(e.body)}return t.has("content-type")&&t.get("content-type")==="application/x-www-form-urlencoded"&&ae(e.body)?new URLSearchParams(e.body).toString():e.body}function wt(e,t){var n;if(t!=null&&t.method)return t.method.toUpperCase();if(e.startsWith("@")){const r=(n=e.split("@")[1])==null?void 0:n.split("/")[0];return Oe.includes(r)?r.toUpperCase():t!=null&&t.body?"POST":"GET"}return t!=null&&t.body?"POST":"GET"}function Ot(e,t){let n;return!(e!=null&&e.signal)&&(e!=null&&e.timeout)&&(n=setTimeout(()=>t==null?void 0:t.abort(),e==null?void 0:e.timeout)),{abortTimeout:n,clearTimeout:()=>{n&&clearTimeout(n)}}}var Rt=class we extends Error{constructor(t,n){super(n||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,we.prototype)}};async function z(e,t){const n=await e["~standard"].validate(t);if(n.issues)throw new Rt(n.issues);return n.value}var Oe=["get","post","put","patch","delete"],_t=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,n){var r,s,c,u;const l=((s=(r=e.plugins)==null?void 0:r.find(i=>{var o;return(o=i.schema)!=null&&o.config?t.startsWith(i.schema.config.baseURL||"")||t.startsWith(i.schema.config.prefix||""):!1}))==null?void 0:s.schema)||e.schema;if(l){let i=t;(c=l.config)!=null&&c.prefix&&i.startsWith(l.config.prefix)&&(i=i.replace(l.config.prefix,""),l.config.baseURL&&(t=t.replace(l.config.prefix,l.config.baseURL))),(u=l.config)!=null&&u.baseURL&&i.startsWith(l.config.baseURL)&&(i=i.replace(l.config.baseURL,""));const o=l.schema[i];if(o){let a=C(U({},n),{method:o.method,output:o.output});return n!=null&&n.disableValidation||(a=C(U({},a),{body:o.input?await z(o.input,n==null?void 0:n.body):n==null?void 0:n.body,params:o.params?await z(o.params,n==null?void 0:n.params):n==null?void 0:n.params,query:o.query?await z(o.query,n==null?void 0:n.query):n==null?void 0:n.query})),{url:t,options:a}}}return{url:t,options:n}}}),St=e=>{async function t(n,r){const s=C(U(U({},e),r),{plugins:[...(e==null?void 0:e.plugins)||[],_t(e||{}),...(r==null?void 0:r.plugins)||[]]});if(e!=null&&e.catchAllError)try{return await ue(n,s)}catch(c){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:c}}}return await ue(n,s)}return t};function Et(e,t){const{baseURL:n,params:r,query:s}=t||{query:{},params:{},baseURL:""};let c=e.startsWith("http")?e.split("/").slice(0,3).join("/"):n||"";if(e.startsWith("@")){const f=e.toString().split("@")[1].split("/")[0];Oe.includes(f)&&(e=e.replace(`@${f}/`,"/"))}c.endsWith("/")||(c+="/");let[u,l]=e.replace(c,"").split("?");const i=new URLSearchParams(l);for(const[f,g]of Object.entries(s||{})){if(g==null)continue;let w;if(typeof g=="string")w=g;else if(Array.isArray(g)){for(const R of g)i.append(f,R);continue}else w=JSON.stringify(g);i.set(f,w)}if(r)if(Array.isArray(r)){const f=u.split("/").filter(g=>g.startsWith(":"));for(const[g,w]of f.entries()){const R=r[g];u=u.replace(w,R)}}else for(const[f,g]of Object.entries(r))u=u.replace(`:${f}`,String(g));u=u.split("/").map(encodeURIComponent).join("/"),u.startsWith("/")&&(u=u.slice(1));let o=i.toString();return o=o.length>0?`?${o}`.replace(/\+/g,"%20"):"",c.startsWith("http")?new URL(`${u}${o}`,c):`${c}${u}${o}`}var ue=async(e,t)=>{var n,r,s,c,u,l,i,o;const{hooks:a,url:f,options:g}=await ct(e,t),w=mt(g),R=new AbortController,P=(n=g.signal)!=null?n:R.signal,p=Et(f,g),F=bt(g),I=await pt(g),E=wt(f,g);let y=C(U({},g),{url:p,headers:I,body:F,method:E,signal:P});for(const T of a.onRequest)if(T){const O=await T(y);typeof O=="object"&&O!==null&&(y=O)}("pipeTo"in y&&typeof y.pipeTo=="function"||typeof((r=t==null?void 0:t.body)==null?void 0:r.pipe)=="function")&&("duplex"in y||(y.duplex="half"));const{clearTimeout:m}=Ot(g,R);let d=await w(y.url,y);m();const _={response:d,request:y};for(const T of a.onResponse)if(T){const O=await T(C(U({},_),{response:(s=t==null?void 0:t.hookOptions)!=null&&s.cloneResponse?d.clone():d}));O instanceof Response?d=O:typeof O=="object"&&O!==null&&(d=O.response)}if(d.ok){if(!(y.method!=="HEAD"))return{data:"",error:null};const O=gt(d),M={data:null,response:d,request:y};if(O==="json"||O==="text"){const B=await d.text(),Re=(c=y.jsonParser)!=null?c:me;M.data=await Re(B)}else M.data=await d[O]();y!=null&&y.output&&y.output&&!y.disableValidation&&(M.data=await z(y.output,M.data));for(const B of a.onSuccess)B&&await B(C(U({},M),{response:(u=t==null?void 0:t.hookOptions)!=null&&u.cloneResponse?d.clone():d}));return t!=null&&t.throw?M.data:{data:M.data,error:null}}const $=(l=t==null?void 0:t.jsonParser)!=null?l:me,D=await d.text(),V=yt(D),h=V?await $(D):null,K={response:d,responseText:D,request:y,error:C(U({},h),{status:d.status,statusText:d.statusText})};for(const T of a.onError)T&&await T(C(U({},K),{response:(i=t==null?void 0:t.hookOptions)!=null&&i.cloneResponse?d.clone():d}));if(t!=null&&t.retry){const T=ft(t.retry),O=(o=t.retryAttempt)!=null?o:0;if(await T.shouldAttemptRetry(O,d)){for(const B of a.onRetry)B&&await B(_);const M=T.getDelay(O);return await new Promise(B=>setTimeout(B,M)),await ue(e,C(U({},t),{retryAttempt:O+1}))}}if(t!=null&&t.throw)throw new ut(d.status,d.statusText,V?h:D);return{data:null,error:C(U({},h),{status:d.status,statusText:d.statusText})}};const Tt=(e,t)=>{var y,m,d,_,$,D,V;const n="credentials"in Request.prototype,r=Be(e==null?void 0:e.baseURL,e==null?void 0:e.basePath)??"/api/auth",s=((y=e==null?void 0:e.plugins)==null?void 0:y.flatMap(h=>h.fetchPlugins).filter(h=>h!==void 0))||[],c={id:"lifecycle-hooks",name:"lifecycle-hooks",hooks:{onSuccess:(m=e==null?void 0:e.fetchOptions)==null?void 0:m.onSuccess,onError:(d=e==null?void 0:e.fetchOptions)==null?void 0:d.onError,onRequest:(_=e==null?void 0:e.fetchOptions)==null?void 0:_.onRequest,onResponse:($=e==null?void 0:e.fetchOptions)==null?void 0:$.onResponse}},{onSuccess:u,onError:l,onRequest:i,onResponse:o,...a}=(e==null?void 0:e.fetchOptions)||{},f=St({baseURL:r,...n?{credentials:"include"}:{},method:"GET",jsonParser(h){return h?He(h,{strict:!1}):null},customFetchImpl:fetch,...a,plugins:[c,...a.plugins||[],...e!=null&&e.disableDefaultFetchPlugins?[]:[Fe],...s]}),{$sessionSignal:g,session:w}=nt(f,e),R=(e==null?void 0:e.plugins)||[];let P={},p={$sessionSignal:g,session:w},F={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"};const I=[{signal:"$sessionSignal",matcher(h){return h==="/sign-out"||h==="/update-user"||h==="/sign-up/email"||h==="/sign-in/email"||h==="/delete-user"||h==="/verify-email"||h==="/revoke-sessions"||h==="/revoke-session"||h==="/change-email"}}];for(const h of R)h.getAtoms&&Object.assign(p,(D=h.getAtoms)==null?void 0:D.call(h,f)),h.pathMethods&&Object.assign(F,h.pathMethods),h.atomListeners&&I.push(...h.atomListeners);const E={notify:h=>{p[h].set(!p[h].get())},listen:(h,K)=>{p[h].subscribe(K)},atoms:p};for(const h of R)h.getActions&&Object.assign(P,(V=h.getActions)==null?void 0:V.call(h,f,E,e));return{get baseURL(){return r},pluginsActions:P,pluginsAtoms:p,pluginPathMethods:F,atomListeners:I,$fetch:f,$store:E}};function Lt(e){return typeof e=="object"&&e!==null&&"get"in e&&typeof e.get=="function"&&"lc"in e&&typeof e.lc=="number"}function Pt(e,t,n){const r=t[e],{fetchOptions:s,query:c,...u}=n||{};return r||(s!=null&&s.method?s.method:u&&Object.keys(u).length>0?"POST":"GET")}function It(e,t,n,r,s){function c(u=[]){return new Proxy(function(){},{get(l,i){if(typeof i!="string"||i==="then"||i==="catch"||i==="finally")return;const o=[...u,i];let a=e;for(const f of o)if(a&&typeof a=="object"&&f in a)a=a[f];else{a=void 0;break}return typeof a=="function"||Lt(a)?a:c(o)},apply:async(l,i,o)=>{const a="/"+u.map(I=>I.replace(/[A-Z]/g,E=>`-${E.toLowerCase()}`)).join("/"),f=o[0]||{},g=o[1]||{},{query:w,fetchOptions:R,...P}=f,p={...g,...R},F=Pt(a,n,f);return await t(a,{...p,body:F==="GET"?void 0:{...P,...(p==null?void 0:p.body)||{}},query:w||(p==null?void 0:p.query),method:F,async onSuccess(I){var m;if(await((m=p==null?void 0:p.onSuccess)==null?void 0:m.call(p,I)),!s||p.disableSignal)return;const E=s.filter(d=>d.matcher(a));if(!E.length)return;const y=new Set;for(const d of E){const _=r[d.signal];if(!_)return;if(y.has(d.signal))continue;y.add(d.signal);const $=_.get();setTimeout(()=>{_.set(!$)},10)}}})}})}return c()}function At(e){const{pluginPathMethods:t,pluginsActions:n,pluginsAtoms:r,$fetch:s,atomListeners:c,$store:u}=Tt(e);let l={};for(const[i,o]of Object.entries(r))l[`use${xe(i)}`]=()=>o;return It({...n,...l,$fetch:s,$store:u},s,t,r,c)}const Ut=globalThis.__sveltekit_1vzddul.env,Z=At({baseURL:Ut.PUBLIC_AUTH_URL||"http://localhost:3000",fetchOptions:{credentials:"include"}});Z.signUp;Z.signIn;const xt=Z.signOut;Z.useSession;export{Z as a,xt as s};
