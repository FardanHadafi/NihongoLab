import{f as h,a as u,c as de}from"../chunks/CsDiZ3u4.js";import{o as He}from"../chunks/CdbuT949.js";import{p as Oe,a as Je,q as e,a9 as f,a5 as t,c as s,r as a,f as pe,s as l,t as y,a6 as X}from"../chunks/IptEdv31.js";import{d as We,s as g,e as ze}from"../chunks/5ZTY1J-d.js";import{i as x}from"../chunks/B_32Z2vQ.js";import{r as ue,s as fe}from"../chunks/gIS0dabI.js";import{s as Ge}from"../chunks/DyT_7vXL.js";import{b as ge}from"../chunks/Dfyq5I04.js";import{g as Ve}from"../chunks/5B9hMlRm.js";var Ye=h('<div class="loading-state svelte-19js34c"><div class="spinner svelte-19js34c"></div> <p class="svelte-19js34c">Loading...</p></div>'),Qe=h('<div class="error-state svelte-19js34c"><div class="error-icon svelte-19js34c">⚠️</div> <h2 class="svelte-19js34c">An Error Has Occurred</h2> <p class="svelte-19js34c"> </p> <button class="retry-btn svelte-19js34c">Retry</button></div>'),Xe=h('<img class="avatar-large svelte-19js34c"/>'),Ke=h('<div class="avatar-large avatar-placeholder svelte-19js34c"> </div>'),Ze=h('<div class="progress-section svelte-19js34c"><div class="progress-header svelte-19js34c"><span class="progress-label svelte-19js34c">Exp Points</span> <span class="progress-value svelte-19js34c"> </span></div> <div class="progress-bar svelte-19js34c"><div class="progress-fill svelte-19js34c"></div></div></div>'),$e=h('<div class="success-message svelte-19js34c"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19js34c"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" class="svelte-19js34c"></path><polyline points="22 4 12 14.01 9 11.01" class="svelte-19js34c"></polyline></svg> <span class="svelte-19js34c"> </span></div>'),es=h('<div class="error-message svelte-19js34c"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19js34c"><circle cx="12" cy="12" r="10" class="svelte-19js34c"></circle><line x1="12" y1="8" x2="12" y2="12" class="svelte-19js34c"></line><line x1="12" y1="16" x2="12.01" y2="16" class="svelte-19js34c"></line></svg> <span class="svelte-19js34c"> </span></div>'),ss=h('<div class="profile-container svelte-19js34c"><div class="profile-header svelte-19js34c"><h1 class="svelte-19js34c">Profile Settings</h1> <p class="subtitle svelte-19js34c">Manage Account Information</p></div> <div class="profile-grid svelte-19js34c"><div class="profile-card info-card svelte-19js34c"><h2 class="svelte-19js34c">Account Information</h2> <div class="avatar-section svelte-19js34c"><!></div> <div class="info-item svelte-19js34c"><label class="info-label svelte-19js34c">User ID</label> <p class="info-value svelte-19js34c"> </p></div> <div class="info-item svelte-19js34c"><label class="info-label svelte-19js34c">Email Address</label> <p class="info-value svelte-19js34c"> </p></div> <div class="info-item svelte-19js34c"><label class="info-label svelte-19js34c">Current Level</label> <p class="info-value level-badge svelte-19js34c"> </p></div> <!></div> <div class="profile-card edit-card svelte-19js34c"><h2 class="svelte-19js34c">Edit Profile</h2> <!> <!> <form class="svelte-19js34c"><div class="form-group svelte-19js34c"><label for="name" class="form-label svelte-19js34c">Name *</label> <input type="text" id="name" class="form-input svelte-19js34c" placeholder="John Doe" required/></div> <div class="form-group svelte-19js34c"><label for="imageUrl" class="form-label svelte-19js34c">Profile Image URL</label> <input type="url" id="imageUrl" class="form-input svelte-19js34c" placeholder="https://example.com/avatar.jpg"/> <p class="form-help svelte-19js34c">Enter an Image URL or Upload File Below</p></div> <div class="form-group svelte-19js34c"><label for="imageFile" class="form-label svelte-19js34c">Or Upload an Image</label> <div class="file-input-wrapper svelte-19js34c"><input type="file" id="imageFile" class="file-input svelte-19js34c" accept="image/jpeg,image/png,image/jpg,image/webp"/> <label for="imageFile" class="file-label svelte-19js34c"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19js34c"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" class="svelte-19js34c"></path><polyline points="17 8 12 3 7 8" class="svelte-19js34c"></polyline><line x1="12" y1="3" x2="12" y2="15" class="svelte-19js34c"></line></svg> <span class="svelte-19js34c"> </span></label></div> <p class="form-help svelte-19js34c">JPG, PNG, WEBP (Max 5MB)</p></div> <div class="form-actions svelte-19js34c"><button type="button" class="btn btn-secondary svelte-19js34c">Reset</button> <button type="submit" class="btn btn-primary svelte-19js34c"> </button></div></form></div></div> <div class="quick-links profile-card svelte-19js34c"><h3 class="svelte-19js34c">Quick Settings</h3> <div class="links-grid svelte-19js34c"><a href="/change-password" class="quick-link svelte-19js34c"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19js34c"><rect x="3" y="11" width="18" height="11" rx="2" ry="2" class="svelte-19js34c"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4" class="svelte-19js34c"></path></svg> <div class="svelte-19js34c"><p class="link-title svelte-19js34c">Change Password</p> <p class="link-description svelte-19js34c">Manage and Change Security Settings</p></div></a> <a href="/dashboard" class="quick-link svelte-19js34c"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-19js34c"><rect x="3" y="3" width="7" height="7" class="svelte-19js34c"></rect><rect x="14" y="3" width="7" height="7" class="svelte-19js34c"></rect><rect x="14" y="14" width="7" height="7" class="svelte-19js34c"></rect><rect x="3" y="14" width="7" height="7" class="svelte-19js34c"></rect></svg> <div class="svelte-19js34c"><p class="link-title svelte-19js34c">Dashboard</p> <p class="link-description svelte-19js34c">Check Your Learning Progress</p></div></a></div></div></div>'),as=h('<div class="profile-page svelte-19js34c"><!></div>');function ps(me,je){Oe(je,!0);let i=f(null),q=f(!0),d=f(""),F=f(!1),B=f(!1),U=f(""),C=f(""),k=f(""),_=f(null),E=f("");He(async()=>{await D(),e(i)&&Ve.from(".profile-card",{duration:.6,y:30,opacity:0,stagger:.1,ease:"power3.out"})});async function D(){try{t(q,!0),t(d,"");const r=await fetch("/api/users/me",{credentials:"include"});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);t(i,await r.json(),!0),e(i)&&(t(C,e(i).name||"",!0),t(k,e(i).image||"",!0),t(E,e(i).image||"",!0))}catch(r){console.error("Failed to fetch profile:",r),t(d,r instanceof Error?r.message:"Failed to load profile",!0)}finally{t(q,!1)}}function he(r){var b;const n=(b=r.target.files)==null?void 0:b[0];if(n){if(n.size>5*1024*1024){t(d,"Image Size Must Be 5MB or Less");return}if(!n.type.startsWith("image/")){t(d,"Please Select an Image File");return}t(_,n,!0);const P=new FileReader;P.onload=m=>{var j;t(E,(j=m.target)==null?void 0:j.result,!0)},P.readAsDataURL(n),t(k,"")}}async function _e(r){const c=new FormData;c.append("image",r);const n=await fetch("/api/users/upload-image",{method:"POST",credentials:"include",body:c});if(!n.ok)throw new Error("Image Upload Failed");return(await n.json()).imageUrl}async function be(r){if(r.preventDefault(),!e(C).trim()){t(d,"Name is required");return}try{t(F,!0),t(d,""),t(U,"");let c=e(k).trim()||null;if(e(_)){t(B,!0);try{c=await _e(e(_))}catch{throw new Error("Image Upload Failed")}finally{t(B,!1)}}const n={name:e(C).trim(),image:c},b=await fetch("/api/users/me",{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)});if(!b.ok)throw new Error("Failed to update profile");const P=await b.json();t(i,{...e(i),...P},!0),c&&t(E,c,!0),t(_,null),t(U,"Your Profile Has Been Updated !"),setTimeout(()=>{t(U,"")},3e3)}catch(c){console.error("Failed to update profile:",c),t(d,c instanceof Error?c.message:"Failed to update profile",!0)}finally{t(F,!1)}}function we(r){return r.split(" ").map(c=>c[0]).join("").toUpperCase().slice(0,2)}function ye(){var r,c;return!((r=e(i))!=null&&r.requiredExp)||!((c=e(i))!=null&&c.currentExp)?0:e(i).currentExp/e(i).requiredExp*100}var L=as(),xe=s(L);{var ke=r=>{var c=Ye();u(r,c)},Ee=r=>{var c=de(),n=pe(c);{var b=m=>{var j=Qe(),I=l(s(j),4),A=s(I,!0);a(I);var S=l(I,2);S.__click=D,a(j),y(()=>g(A,e(d))),u(m,j)},P=m=>{var j=de(),I=pe(j);{var A=S=>{var N=ss(),K=l(s(N),2),R=s(K),T=l(s(R),2),Pe=s(T);{var Fe=v=>{var o=Xe();y(()=>{fe(o,"src",e(E)),fe(o,"alt",e(i).name)}),u(v,o)},Ue=v=>{var o=Ke(),p=s(o,!0);a(o),y(w=>g(p,w),[()=>we(e(i).name)]),u(v,o)};x(Pe,v=>{e(E)?v(Fe):v(Ue,!1)})}a(T);var H=l(T,2),Z=l(s(H),2),Ce=s(Z,!0);a(Z),a(H);var O=l(H,2),$=l(s(O),2),Ie=s($,!0);a($),a(O);var J=l(O,2),ee=l(s(J),2),Se=s(ee,!0);a(ee),a(J);var Be=l(J,2);{var Me=v=>{var o=Ze(),p=s(o),w=l(s(p),2),Ne=s(w);a(w),a(p);var ne=l(p,2),Re=s(ne);a(ne),a(o),y(Te=>{g(Ne,`${e(i).currentExp??""} / ${e(i).requiredExp??""} XP`),Ge(Re,`width: ${Te??""}%`)},[ye]),u(v,o)};x(Be,v=>{e(i).requiredExp&&v(Me)})}a(R);var se=l(R,2),ae=l(s(se),2);{var qe=v=>{var o=$e(),p=l(s(o),2),w=s(p,!0);a(p),a(o),y(()=>g(w,e(U))),u(v,o)};x(ae,v=>{e(U)&&v(qe)})}var te=l(ae,2);{var De=v=>{var o=es(),p=l(s(o),2),w=s(p,!0);a(p),a(o),y(()=>g(w,e(d))),u(v,o)};x(te,v=>{e(d)&&e(i)&&v(De)})}var W=l(te,2),z=s(W),le=l(s(z),2);ue(le),a(z);var G=l(z,2),M=l(s(G),2);ue(M),M.__input=()=>{t(E,e(k),!0),t(_,null)},X(2),a(G);var V=l(G,2),re=l(s(V),2),ie=s(re);ie.__change=he;var ce=l(ie,2),ve=l(s(ce),2),Le=s(ve,!0);a(ve),a(ce),a(re),X(2),a(V);var oe=l(V,2),Y=s(oe);Y.__click=D;var Q=l(Y,2),Ae=s(Q,!0);a(Q),a(oe),a(W),a(se),a(K),X(2),a(N),y(()=>{g(Ce,e(i).id),g(Ie,e(i).email),g(Se,e(i).levelName||"N5"),M.disabled=!!e(_),g(Le,e(_)?e(_).name:"Select File"),Y.disabled=e(F),Q.disabled=e(F)||e(B),g(Ae,e(B)?"Uploading...":e(F)?"Saving...":"Save")}),ze("submit",W,be),ge(le,()=>e(C),v=>t(C,v)),ge(M,()=>e(k),v=>t(k,v)),u(S,N)};x(I,S=>{e(i)&&S(A)},!0)}u(m,j)};x(n,m=>{e(d)&&!e(i)?m(b):m(P,!1)},!0)}u(r,c)};x(xe,r=>{e(q)?r(ke):r(Ee,!1)})}a(L),u(me,L),Je()}We(["click","input","change"]);export{ps as component};
